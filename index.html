<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <title>Ativando conta...</title>
  <style>
    body { font-family: sans-serif; text-align: center; margin-top: 10vh; }
    .success { color: #34C759; font-size: 2em; }
    .error { color: #FF3B30; font-size: 1.2em; }
    .open-app { margin-top: 2em; font-size: 1.2em; }
    button { padding: 1em 2em; font-size: 1em; border-radius: 8px; background: #34C759; color: #fff; border: none; }
  </style>
</head>
<body>
  <div id="status">⏳ Ativando sua conta...</div>
  <div class="open-app" style="display:none" id="openAppDiv">
    <button onclick="window.location.href='1langapp://ativado'">Abrir o app</button>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <script>
    // Substitua pelos dados do seu projeto:
    const SUPABASE_URL = 'https://zselggjwiikfgxjsbaqw.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpzZWxnZ2p3aWlrZmd4anNiYXF3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDU0MjQyMjQsImV4cCI6MjA2MTAwMDIyNH0.MGwkhL3FdgPJZ5nHzOfJE2CbPpsVClnrCze69HHWZbU';

    const urlParams = new URLSearchParams(window.location.search);
    const token = urlParams.get('token');
    const type = urlParams.get('type');

    async function confirmEmail() {
      if (!token || !type) {
        document.getElementById('status').innerHTML = '<span class="error">Link inválido!</span>';
        return;
      }
      const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
      try {
        const { error } = await supabase.auth.verifyOtp({ token, type });
        if (error) {
          document.getElementById('status').innerHTML = '<span class="error">Erro ao ativar conta: ' + error.message + '</span>';
        } else {
          document.getElementById('status').innerHTML = '<span class="success">✅ Conta ativada com sucesso!</span><p>Agora você pode fazer login normalmente no app.</p>';
          document.getElementById('openAppDiv').style.display = 'block';
          setTimeout(() => {
            window.location.href = '1langapp://ativado';
          }, 1000);
        }
      } catch (e) {
        document.getElementById('status').innerHTML = '<span class="error">Erro inesperado: ' + e.message + '</span>';
      }
    }
    confirmEmail();
  </script>
</body>
</html>
